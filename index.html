<!DOCTYPE html>
<html>
<head>
    <title>Video Call</title>
    <script src="https://cdn.jsdelivr.net/npm/@livekit/client-sdk@1.8.1/dist/livekit-client.umd.min.js"></script>
    <style>
        body { margin: 20px; font-family: Arial; background: #667eea; color: white; }
        video { width: 100%; max-width: 600px; border: 3px solid white; }
        button { padding: 15px 30px; margin: 10px; background: white; color: #667eea; }
        #status { padding: 15px; margin: 20px; background: rgba(255,255,255,0.2); }
    </style>
</head>
<body>
    <h1>üé• Video Call</h1>
    <div id="status">Loading...</div>
    <video id="localVideo" autoplay muted playsinline></video>
    <div>
        <button onclick="startCamera()">Start Camera</button>
        <button onclick="connectToLiveKit()">Connect to LiveKit</button>
    </div>
    
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const roomName = urlParams.get('room');
        const token = urlParams.get('token');
        
        const statusEl = document.getElementById('status');
        
        if (!roomName || !token) {
            statusEl.innerHTML = '‚ùå Missing room or token';
        } else {
            statusEl.innerHTML = `‚úÖ Room: ${roomName}`;
        }
        
        async function startCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                document.getElementById('localVideo').srcObject = stream;
                statusEl.innerHTML += '<br>üìπ Camera started';
            } catch (error) {
                statusEl.innerHTML += '<br>‚ùå Camera error: ' + error.message;
            }
        }
        
        async function connectToLiveKit() {
            statusEl.innerHTML += '<br>üîÑ Connecting to LiveKit...';
            
            try {
                const room = new LiveKitClient.Room();
                await room.connect('wss://video-20qatdd3.livekit.cloud', token);
                statusEl.innerHTML += '<br>‚úÖ Connected to LiveKit!';
                
                // Start camera and publish
                const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                for (const track of stream.getTracks()) {
                    await room.localParticipant.publishTrack(track);
                }
                
            } catch (error) {
                statusEl.innerHTML += '<br>‚ùå LiveKit error: ' + error.message;
            }
        }
        
        window.addEventListener('load', () => {
            if (roomName && token) {
                setTimeout(startCamera, 1000);
            }
        });
    </script>
</body>
</html>
